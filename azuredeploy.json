{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {

    "name": {
      "type": "string",
      "metadata": {
        "description": "Name"
      }
    },
    "spoke1-tag": {
      "type": "string",
      "defaultValue": "VA",
      "metadata": {
        "description": "Name"
      }
    },
    "spoke2-tag": {
      "type": "string",
      "defaultValue": "VB",
      "metadata": {
        "description": "Name"
      }
    }
  },

  "variables": {
    "spoke1-vnet-name": "[concat(parameters('name'), '_vnet_', parameters('spoke1-tag'))]",
    "spoke2-vnet-name": "[concat(parameters('name'), '_vnet_', parameters('spoke2-tag'))]",

    "spoke1-vsrx-name": "[concat(parameters('name'), '-vsrx-', parameters('spoke1-tag'))]",
    "spoke2-vsrx-name": "[concat(parameters('name'), '-vsrx-', parameters('spoke2-tag'))]",

    "storageAccountName": "jnstorage",
    "virtualMachineSize": "Standard_DS3_v2",
    "vSRX-model": "BYOLv2",

    "vsrx-username": "pocadministrator",
    "vsrx-password": "2ngVOy20uqlJ"


  },
  "resources": [
    {
      "apiVersion": "2017-05-10",
      "name": "spoke1",
      "type": "Microsoft.Resources/deployments",
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "https://raw.githubusercontent.com/woutervanranst/vsrx/master/spoke.azuredeploy.json",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "storageAccountName": { "value": "[variables('storageAccountName')]" },
          "vSRX-model": { "value": "[variables('vSRX-model')]" },
          "virtualMachineSize": { "value": "[variables('virtualMachineSize')]" },
          "vsrx-name": { "value": "[variables('spoke1-vsrx-name')]" },
          "vsrx-username": { "value": "[variables('vsrx-username')]" },
          "vsrx-password": { "value": "[variables('vsrx-password')]" },
          
          "vnet-name": {
            "value": "[variables('spoke1-vnet-name')]"
          },
          "vnet-address-space": {
            "value": "192.168.0.0/16"
          },


          "vsrx-addr-ge-0-0-0": {
            "value": "192.168.10.20"
          },
          "vsrx-addr-ge-0-0-1": {
            "value": "192.168.20.20"
          },
          "vsrx-addr-ge-0-0-2": {
            "value": "192.168.30.20"
          },

          "vnet-mgt-subnet-name": {
            "value": "mgt-subnet"
          },
          "vnet-mgt-subnet-prefix": {
            "value": "192.168.0.0/24"
          },
          "vnet-untrust-subnet-name": {
            "value": "untrust-subnet"
          },
          "vnet-untrust-subnet-prefix": {
            "value": "192.168.10.0/24"
          },
          "vnet-trust-subnet-name": {
            "value": "trust-subnet"
          },
          "vnet-trust-subnet-prefix": {
            "value": "192.168.20.0/24"
          },
          "vnet-interconnect-subnet-name": {
            "value": "interconnect-subnet"
          },
          "vnet-interconnect-subnet-prefix": {
            "value": "192.168.30.0/24"
          }


        }
      }
    },

    {
      "apiVersion": "2017-05-10",
      "name": "spoke2",
      "type": "Microsoft.Resources/deployments",
      "properties": {
        "mode": "Incremental",
        "templateLink": {
          "uri": "https://raw.githubusercontent.com/woutervanranst/vsrx/master/spoke.azuredeploy.json",
          "contentVersion": "1.0.0.0"
        },
        "parameters": {
          "storageAccountName": {
            "value": "[variables('storageAccountName')]"
          },
          "vSRX-model": {
            "value": "[variables('vSRX-model')]"
          },
          "virtualMachineSize": { "value": "[variables('virtualMachineSize')]" },


          "vsrx-name": {
            "value": "[variables('spoke2-vsrx-name')]"
          },



          "vsrx-username": { "value": "[variables('vsrx-username')]" },
          "vsrx-password": { "value": "[variables('vsrx-password')]" },
          "vnet-name": {
            "value": "[variables('spoke2-vnet-name')]"
          },
          "vnet-address-space": {
            "value": "192.168.0.0/16"
          },


          "vsrx-addr-ge-0-0-0": {
            "value": "192.168.10.20"
          },
          "vsrx-addr-ge-0-0-1": {
            "value": "192.168.20.20"
          },
          "vsrx-addr-ge-0-0-2": {
            "value": "192.168.30.20"
          },

          "vnet-mgt-subnet-name": {
            "value": "mgt-subnet"
          },
          "vnet-mgt-subnet-prefix": {
            "value": "192.168.0.0/24"
          },
          "vnet-untrust-subnet-name": {
            "value": "untrust-subnet"
          },
          "vnet-untrust-subnet-prefix": {
            "value": "192.168.10.0/24"
          },
          "vnet-trust-subnet-name": {
            "value": "trust-subnet"
          },
          "vnet-trust-subnet-prefix": {
            "value": "192.168.20.0/24"
          },
          "vnet-interconnect-subnet-name": {
            "value": "interconnect-subnet"
          },
          "vnet-interconnect-subnet-prefix": {
            "value": "192.168.30.0/24"
          }
        }


      }
    }
  ],
  "outputs": {
  }
}